
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tablet Goethe </title>
    <link rel="stylesheet" href="./style_goethe.css">
    
     <script src="js/aframe.min.js"></script>
     <script src="js/script.js"></script>


    <script src="js/aframe.extras.js"></script>
    
    <script src="panorama/helper.js"></script>
    <script src="panorama/hotspot.js"></script>
    <script src="panorama/panorama.js"></script>
    <script src="panorama/tour.js"></script>
     
    
     <script src="js/transparent-video-shader.js"></script>
    <script src="js/event-set-component.js"></script>
    <script src="js/billboard-look-component.js"></script>
  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    
    
    
  </head>
  
  
  
  <body>
    
        <div id="overlay">
  <div id="hinweis-container">
    <img id="nutzerhinweis" src="./img/Nutzerhinweis_Tablet.png" alt="Nutzerhinweis">
    <img id="start-button" src="./img/Ueberspringen_Button.png" alt="Jetzt Starten" onclick="hideOverlay()">
  </div>
</div>
   
<div class="switcher-nav">
  <a href="index.html" class="go-to-index-button" id="indexButton">
    <i class="fas fa-home"></i> 
  </a> 
  <div class="switcher-nav-inner">
      <a href="cmh.html" class="arrow left-arrow">←</a>
      <div class="footer-text">Johann Wolfgang von Goethe</div>
      <a href="humboldt.html" class="arrow right-arrow">→</a>
  </div>
</div>


      <div class="video-container">
        
   <video id="Goethe_subs_1"
          crossorigin="anonymous"
          playsinline
          webkit-playsinline 
          muted
          >
          <!-- HEVC video for safari support -->
          <source src="./videos/Goethe_subs_1.mov" type="video/mp4;codecs=hvc1">
          <!-- WEBM video for chrome and firefox -->
          <source src="./videos/Goethe_subs_1.webm" type="video/webm" />
        </video>  
        
          <video id="Goethe_subs_2"
          crossorigin="anonymous"
          playsinline
          webkit-playsinline
          muted>
          <!-- HEVC video for safari support -->
          <source src="./videos/Goethe_subs_2.mov" type="video/mp4;codecs=hvc1">
          <!-- WEBM video for chrome and firefox -->
          <source src="./videos/Goethe_subs_2.webm" type="video/webm" />
        </video>  
        
           <video id="Goethe_subs_3"
          crossorigin="anonymous"
          playsinline
          webkit-playsinline
          muted>
          <!-- HEVC video for safari support -->
          <source src=./videos/Goethe_subs_3.mov" type="video/mp4;codecs=hvc1">
          <!-- WEBM video for chrome and firefox -->
          <source src="./videos/Goethe_subs_3.webm" type="video/webm" />
        </video>  
        
        
          
     
    </div>
    
    
    
    <a-scene cursor="rayOrigin: mouse" renderer="colorManagement: true;" loading-screen="dotsColor: white; backgroundColor: #A4BC49"
    xr-mode-ui="enabled: false"
              reflection="directionalLight:a-light#dirlight;"  >          
      <!-- Preload assets like panoramas and content -->
      <a-assets timeout="10000">

        <img id="Goethefelsen" src="./img/Goethe_Pano_2.jpg" crossorigin="anonymous">
<img id="Goethefelsen_2" src="./img/Goethe_Pano_1.jpg" crossorigin="anonymous">
<img id="Ochsenkopf" src="./img/Goethe_Pano_3.jpg" crossorigin="anonymous">

<img id="Info_Ochsenkopf" src="./img/Infotaferl_Ochsenkopf.png" crossorigin="anonymous">
<img id="Info_Zeichnung" src="./img/Infotafel_Zeichnung.png" crossorigin="anonymous">
<img id="Info_Schreikopf" src="./img/Infotafel_-Schrekopf.png" crossorigin="anonymous">

<img id="zumFels" src="./img/Goethefels.png" crossorigin="anonymous">
<img id="zumOchsenkopf" src="./img/zurückOchsenkopf.png" crossorigin="anonymous">
<img id="zuReise" src="./img/zuWanderungGoethe.png" crossorigin="anonymous">

<img id="Schatten" src="./img/Schatten.png" crossorigin="anonymous">
<img id="Hinweis_Kopf" src="./img/Hinweis_Tablet_Kopf.png" crossorigin="anonymous">

<img id="Goethe_speaking_1_poster" src="./img/Goethe_poster.png" crossorigin="anonymous">


<a-asset-item id="Steinkopf_Modell" src="./models/Schreikopf_Artefakt.glb" crossorigin="anonymous"></a-asset-item>


<video id="Goethe_speaking_1" crossorigin="anonymous" playsinline webkit-playsinline>
  <source src="./videos/Goethe_1-1.mov" type="video/mp4;codecs=hvc1">
  <source src="./videos/Goethe_speaking_1.webm" type="video/webm">
</video>

<video id="Goethe_speaking_3" crossorigin="anonymous" playsinline webkit-playsinline>
  <source src="./videos/Goethe_3_speaking.mov" type="video/mp4;codecs=hvc1">
  <source src="./videos/Goethe_speaking_3.webm" type="video/webm">
</video>

<video id="Goethe_speaking_2" crossorigin="anonymous" playsinline webkit-playsinline>
  <source src="./videos/Goethe_speaking_2.mov" type="video/mp4;codecs=hvc1">
  <source src="./videos/Goethe_speaking_2.webm" type="video/webm">
</video>

<video id="Platzhalter" crossorigin="anonymous" playsinline webkit-playsinline muted>
  <source src="./videos/Platzhalter.mov" type="video/mp4;codecs=hvc1">
  <source src="./videos/Platzhalter.webm" type="video/webm">
</video>

    
      </a-assets>

      
      <a-tour>
        
        <!-- Panorama nodes and content -->
        <a-panorama id="Goethe_1" src="#Ochsenkopf" rotation="0 0 0" >
          
          
 <a-entity position="-0.375 0 0.305">   
       <a-entity position="-0.008 -0.493 -1.386">
      
          <a-box  static-body color="#EEF9FF" position="1.414 1.473 2.429" width=".5" depth=".5" height="1" opacity="1"> </a-box>
           </a-entity>
          
                    <a-image billboard src="#Info_Ochsenkopf" material.transparent="true"  position="-1.540 1.680 -5.678" alphatest= "0.5;" class="clickable"
                 rotation="0 0 0" width="1" height="1.126" opacity="1" scale="6 6 6"> </a-image>   
          
     
              <a-entity >
        <a-entity billboard id="portrait1" 
        material="shader: transparent-video; alphaTest:0.5; src: #Goethe_speaking_1; transparent: true; depthWrite:false;"
                  scale= ".2 .2 .2"
        geometry="primitive: plane;
                  width: 4.8;
                  height: 4.8;"
        position="1.237 1.896 0.976"
        rotation="0 -160 0"> </a-entity>  
       <a-image src="#Schatten" rotation="90 0 0" position="1.421 1.483 0.996" material="alphaTest:0; color: #000000" material.transparent="true" width=".5" height=".5" scale="1 1 1" ></a-image>
                
                  <a-entity billboard id="video1_poster" 
        scale= ".2 .2 .2"
        material="src: #Goethe_speaking_1_poster; alphaTest:0.5; transparent: true; shader:flat;"
        geometry="primitive: plane;
                   width: 4.8;
                  height: 4.8;"
                  rotation="0 -160 0"
        position="1.237 1.896 0.976"> </a-entity>
                
</a-entity>
            
            </a-entity>
          
 
        </a-panorama>
        
        
       
        <a-panorama id="Goethe_2" src="#Goethefelsen" rotation="0 -90 0" visible="false">
                    
         <a-image billboard src="#Info_Zeichnung" material.transparent="true"  position="3.687 1.7 2.895" alphatest= "0.5;" 
                 rotation="0 0 0" width="1" height="1.042" opacity="1" scale="5 5 5"> </a-image>   
          
          
          
               <a-entity >
        <a-entity billboard id="portrait2" 
        material="shader: transparent-video; alphaTest:0.5; src: #Goethe_speaking_2; transparent: true; depthWrite:false;"
                  scale= "1.500 1.500 1.500"
        geometry="primitive: plane;
                  width: 4.8;
                  height: 4.8;"
        position="-3.634 1.886 6.586"
        rotation="0 -160 0"> </a-entity>  
       <a-image src="#Schatten" rotation="90 0 0" position="-3.629 -1.476 6.363" material="alphaTest:0; color: #000000" material.transparent="true" width=".5" height=".5" 
                scale="5 5 5" ></a-image>
</a-entity>
  
          
          
        </a-panorama>
        
        
         <a-panorama id="Goethe_3" src="#Goethefelsen_2" rotation="0 -90 0" visible="false" >
                 
               <a-image billboard src="#Hinweis_Kopf" scale="1.5 1.5 1.5" rotation="0 90 0" position="-4.927 2 -0.060" material.transparent="true" width="1.5" height=".5"
                  ></a-image>
           
           <a-entity>
             
             
               <a-entity position="4.420 0 0"  >
        <a-entity billboard id="portrait3" 
        material="shader: transparent-video; alphaTest:0.5; src: #Goethe_speaking_3; transparent: true;depthWrite:false;"
                  scale= "3 3 3"
        geometry="primitive: plane;
                  width: 4.8;
                  height: 4.8;"
        position="2.782 -1.330 -11.906"
        rotation="0 0 0"> </a-entity>  
       <a-image src="#Schatten" rotation="90 0 0" position="2.070 -8.007 -11.777" material="alphaTest:0; color: #000000" material.transparent="true" width=".5" height=".5" 
                scale="20 20 20" ></a-image>
</a-entity>
             
             </a-entity>
           
          
  
            <a-image billboard src="#Info_Schreikopf" material.transparent="true"  position="-4.010 1.800 -4.574" alphatest= "0.5;" 
                 rotation="0 0 0" width="1" height="0.9563" opacity="1" scale="4 4 4"> </a-image>   
          
          

         <a-entity class="clickable" id="Steinkopf_hover" gltf-model="#Steinkopf_Modell" scale="1.500 1.500 1.500" position="-3.795 1.211 -4.380" rotation="-55.000 -120 -18"
                    event-set__enter="_target: #Steinkopf_hover; _event: mouseenter; animation.property: position; dir: alternate; animation.to: -1.692 1.685 -1.923 animation.easing: easeInOutQuad; animation.dur: 3000 ;"
                    event-set__enter_2="_target: #Steinkopf_hover; _event: mouseleave; animation.property: position; dir: alternate;  animation.to: -3.795 1.211 -4.380 animation.easing: easeInOutQuad; animation.dur: 1000;"
                     
                   ></a-entity>
              



      

        </a-panorama>
        
        
        
        
        
        <!-- Links between panoramas -->
      
          <a-hotspot id="trigger2" billboard class="clickable" for="Goethe_1" to="Goethe_2" position="-3.802 2 -0.319" rotation="0 90 0" 
                event-set__enter2="_target: #Goethe_1; _event: click; animation.property: scale; animation.to: 0 0 0 animation.easing: easeInOutQuad; animation.dur: 0.00000001;"
                event-set__click="_target: #video1_poster; _event: click; animation.property: material.opacity; dir: alternate; animation.to: 0 animation.easing: easeInOutQuad; animation.dur: 2000;"
                event-set__enter="_target: #trigger1; _event: mouseenter; animation.property: scale; dir: alternate; animation.to: 0 0 0 animation.easing: easeInOutQuad; animation.dur: 3000 ;"

>
          <a-image class="clickable" src="#zumFels" material.transparent="true" width="1.5" height=".5"
                   event-set__enter="_event: mouseleave; opacity: 1;"
                 event-set__leave="_event: mouseenter; opacity: .5; delay:2000;"></a-image>
        </a-hotspot>
        
           <a-hotspot id="trigger3" billboard class="clickable" for="Goethe_2" to="Goethe_3" position="1.873 1.5 3.225" rotation="0 90 0" visible="false"
                    scale="0 0 0">
          <a-image class="clickable" src="#zuReise" material.transparent="true" width="2.25" height="0.5"
                   event-set__enter="_event: mouseleave; opacity: 1;"
                 event-set__leave="_event: mouseenter; opacity: .5; delay:2000;"></a-image>
        </a-hotspot>
        
       
        
         <a-hotspot id="trigger4" billboard class="clickable" for="Goethe_3" to="Goethe_1" position="-2.564 2.000 0.403" rotation="0 90 0" visible="false"
                    scale="0 0 0"
                                    event-set__enter2="_target: #Goethe_1; _event: click; animation.property: scale; animation.to: 1 1 1 animation.easing: easeInOutQuad; animation.dur: 0.00000001;"
>
          <a-image class="clickable" src="#zumOchsenkopf" material.transparent="true" width="1.5" height=".5"
                   event-set__enter="_event: mouseleave; opacity: 1;"
                 event-set__leave="_event: mouseenter; opacity: .5; delay:2000;"></a-image>
        </a-hotspot>
        
        
        
        
    
         
      <a-entity light="type: ambient; color: #888"></a-entity>
      <a-entity light="type: ambient; color: #888" position="1 1 1"></a-entity>
      <a-entity light="type: directional; color: #fff; intensity: 0.5" position="-1 1 0"></a-entity>
      <a-entity light="type: directional; color: #fff; intensity: 0.5" position="1 1 0"></a-entity>
        
         
      </a-tour>

<a-entity id="rig" rotation="0 -140 0"  >
       <a-camera id="cam" look-controls="enabled: true; touchEnabled: false; mouseEnabled: true; magicWindowTrackingEnabled: true;"  position="0 1.8 0" fov="60" >
       
        <a-entity id="timerText" position="0 0.15 -1.5" text="value: ; color: white; align: center; width: 3;">
        </a-entity> 

      </a-camera>
      </a-entity>
    </a-scene>
    <script>

 

 // Prüfen, ob die Seite in einem iframe geladen ist
 if (window.self !== window.top) {
    // Wenn die Seite in einem iframe geladen ist, das switcher-nav-Element ausblenden
    document.addEventListener("DOMContentLoaded", function() {
      var switcherNav = document.querySelector('.switcher-nav');
      if (switcherNav) {
        switcherNav.style.display = 'none';
      }
    });
  }

      
             AFRAME.registerComponent('animation-handler', {
    init: function () {
      var box = this.el;
      var isAnimating = false;

      box.addEventListener('click', function () {
        if (!isAnimating) {
          isAnimating = true;
          box.emit('startAnimation');

          // Set a timeout to reset isAnimating after the longest animation duration
          setTimeout(function() {
            isAnimating = false;
          }, 8000);  // 8000 ms is the duration of the longest animation
        }
      });
    }
  });
      
      
                      // Globale Variable für das derzeit abgespielte Video
let currentVideo = null;

function playVideo(videoId) {
  const videoEl = document.querySelector(videoId);


  if (currentVideo && currentVideo !== videoEl) {
    currentVideo.pause();
    currentVideo.currentTime = 0; 
  }

  videoEl.muted = true; 
  videoEl.play().then(() => {
    videoEl.muted = false;
    currentVideo = videoEl; 
  }).catch((error) => {
    console.error("Video konnte nicht abgespielt werden: ", error);
  });
}

AFRAME.registerComponent('play-video-on-click', {
  schema: {
    videoId: { type: 'string' }
  },
  init: function () {
    const videoId = this.data.videoId;
    this.el.addEventListener('click', function () {
      playVideo(videoId);
    });
  }
});

// Attach the component to the buttons with the respective video IDs
document.querySelector('#start-button').setAttribute('play-video-on-click', 'videoId: #Goethe_speaking_1');
document.querySelector('#trigger2').setAttribute('play-video-on-click', 'videoId: #Goethe_speaking_2');
document.querySelector('#trigger3').setAttribute('play-video-on-click', 'videoId: #Goethe_speaking_3');
document.querySelector('#trigger4').setAttribute('play-video-on-click', 'videoId: #Platzhalter');




const trigger2 = document.querySelector('#trigger2');
const trigger3 = document.querySelector('#trigger3');
const trigger4 = document.querySelector('#trigger4');

const trigger1 = document.querySelector('#start-button');

       
const sub1 = document.querySelector('#Goethe_subs_1');
const sub2 = document.querySelector('#Goethe_subs_2');
const sub3 = document.querySelector('#Goethe_subs_3');
const sub4 = document.querySelector('#Platzhalter');

// Helper function to show a specific video and hide others
function showVideo(videoToShow) {
    const videos = [sub1, sub2, sub3, sub4];
    videos.forEach(video => {
        if (video === videoToShow) {
            video.classList.remove('hidden');
            video.classList.add('visible');
            video.currentTime = 0; // Ensure the video starts from the beginning
        } else {
            video.classList.remove('visible');
            video.classList.add('hidden');
        }
    });
}

// Helper function to hide a specific video
function hideVideo(videoToHide) {
    video.currentTime = 0;
  videoToHide.classList.remove('visible');
    videoToHide.classList.add('hidden');
  
}

// Initialize videos to be hidden
window.addEventListener('load', () => {
    [sub1, sub2, sub3].forEach(video => {
        hideVideo(video);
    });
});

// Event listeners for triggers
trigger1.addEventListener('click', () => {
    setTimeout(() => {
        showVideo(sub1); // Show sub1 and hide others
        sub1.play();
    }, 0); // Delay in milliseconds
});

trigger2.addEventListener('click', () => {
    setTimeout(() => {
        showVideo(sub2); // Show sub2 and hide others
        sub2.play();
    }, 0); // Delay in milliseconds
});

trigger3.addEventListener('click', () => {
    setTimeout(() => {
        showVideo(sub3); // Show sub3 and hide others
        sub3.play();
    }, 0); // Delay in milliseconds
});

trigger4.addEventListener('click', () => {
    setTimeout(() => {
        showVideo(sub4); // Show sub4 and hide others
        sub4.play();
    }, 0); // Delay in milliseconds
});
       
      function hideOverlay() {
  document.getElementById("overlay").style.display = "none";
}
 

    document.getElementById('start-button').addEventListener('click', function() {
    const video = document.querySelector('#Goethe_speaking_1');
    const poster = document.querySelector('#video1_poster');

    // Play the video
    video.play().catch(error => console.error('Error playing video:', error));
    
    // Set the opacity of the poster to 0 with a duration of 2000ms
    poster.setAttribute('animation', {
        property: 'material.opacity',
        to: '0',
        dur: '1000'
    });
});

function stopVideo() {
    const video = document.querySelector('#Goethe_speaking_1');
    
    // Stop the video and reset the time
    if (video) {
        video.pause();
        video.currentTime = 0;
    }
}

document.getElementById('trigger2').addEventListener('click', stopVideo);
document.getElementById('trigger4').addEventListener('click', stopVideo);

          document.getElementById('trigger4').addEventListener('click', function() {
    // Make the overlay visible again
    document.getElementById("overlay").style.display = "flex";
    
    // Reset the rotation of the cameraRig
    const rig = document.querySelector('#rig');
    if (rig) {
        rig.setAttribute('rotation', '0 -90 0');
    }
});


var inactivityDelay = 90000; // 10 Sekunden bis zum Countdown-Start
        var countdownTime = 10; // 10 Sekunden Countdown
        var inactivityTimer;
        var countdownTimer;
        var timerTextEntity;

        function restartApplication() {
            location.reload();
        }

        function resetTimer() {
            clearTimeout(inactivityTimer);
            clearInterval(countdownTimer);
            timerTextEntity.setAttribute('text', 'value', '');
            inactivityTimer = setTimeout(startCountdown, inactivityDelay);
        }

        function startCountdown() {
            var remainingTime = countdownTime;
            countdownTimer = setInterval(function() {
                timerTextEntity.setAttribute('text', 'value', 'Weiter oder Neustart in: ' + remainingTime + ' sec');
                remainingTime--;
                if (remainingTime < 0) {
                    clearInterval(countdownTimer);
                    restartApplication();
                }
            }, 1000);
        }

        function setupInactivityTimer() {
            timerTextEntity = document.getElementById('timerText');
            document.addEventListener('mousemove', resetTimer);
            document.addEventListener('mousedown', resetTimer);
            document.addEventListener('keypress', resetTimer);
            document.addEventListener('touchstart', resetTimer);
            document.addEventListener('scroll', resetTimer);
            resetTimer();
        }

        window.onload = function() {
            setupInactivityTimer();

            // Hinzufügen von A-Frame-spezifischen Ereignissen
            var sceneEl = document.querySelector('a-scene');
            sceneEl.addEventListener('click', resetTimer);
            sceneEl.addEventListener('touchstart', resetTimer);

            // A-Frame Raycaster Interaktionserkennung
            var raycastTargets = document.querySelectorAll('.clickable');
            raycastTargets.forEach(function (target) {
                target.addEventListener('click', resetTimer);
            });
        };

  

  

      </script>
  </body>
</html>